[gcode_macro PRINT_START]
variable_bedtemp: 0
variable_hotendtemp: 0
variable_chambertemp: 0
gcode:      
  {% set bed = params.BED|int %}
  {% set hotend = params.HOTEND|int %}
  {% set chamber = params.CHAMBER|default(0)|int %}

  SET_GCODE_VARIABLE MACRO=PRINT_START VARIABLE=bedtemp VALUE={bed}   
  SET_GCODE_VARIABLE MACRO=PRINT_START VARIABLE=hotendtemp VALUE={hotend} 
  SET_GCODE_VARIABLE MACRO=PRINT_START VARIABLE=chambertemp VALUE={chamber}   

  STATUS_READY
  SET_PIN PIN=caselight VALUE=1                                                        ; turn on case light
  CLEAR_PAUSE                                                                          ; clear pause
  UPDATE_DELAYED_GCODE ID=DELAYED_OFF DURATION=0                                       ; cancel off timer (if there is one)
  _RESETSPEEDS                                                                         ; reset speed, accel etc to configured values
  BED_MESH_CLEAR                                                                       ; clear bed mesh

  STATUS_HEATING                                                                       ; reset LCD RGB
  M104 S150                                                                            ; set hotend to no-ooze temp
  M140 S{bed}                                                                          ; set bed to target temp

  STATUS_HOMING
  G28                                                                                  ; home
  G90                                                                                  ; absolute positioning

  STATUS_HEATING
  {% if printer["temperature_sensor chamber"].temperature < chamber %}                 ; - if chamber is not at temp yet:
    HEATSOAK T={bed} MOVE=1                                                            ;   heatsoak macro + park in center
    M190 S{bed}                                                                        ;   wait for bed final temp
    TEMPERATURE_WAIT SENSOR="temperature_sensor chamber" MINIMUM={chamber}             ;   wait for chamber final temp
  {% else %}                                                                           ; - if chamber is already at temp:
    {% if printer.heater_bed.temperature < (bed-2) %}                                  ; -- but bed is not fully heated (within 2C):
      HEATSOAK T={bed} MOVE=1                                                          ;       heatsoak and park
      M190 S{bed}                                                                      ;       wait for bed final temp
    {% else %}                                                                         ; -- and bed is already heated:
      HEATSOAK T={bed} MOVE=0                                                          ;       "heatsoak" without parking (only still calling this because it does some other things like turn off exahaust fan)
    {% endif %}
  {% endif %}
  M106 S0                                                                              ; turn off part cooling fan (from heatsoak)

  STATUS_LEVELING
  QUAD_GANTRY_LEVEL                                                                    ; quad gantry level
  G28 Z                                                                                ; home z
  G90                                                                                  ; absolute positioning

  STATUS_MESHING
  BED_MESH_CALIBRATE                                                                   ; mesh
  G28 Z                                                                                ; one more Z home with hot nozzle

  STATUS_CLEANING
  G0 X260 Z15 Y{printer.toolhead.axis_maximum.y} F19500                                ; move to left of nozzle brush
  M109 S{hotend}                                                                       ; set & wait for hotend final temp
  CLEANNOZZLE                                                                          ; clean nozzle while hot

  STATUS_PRINTING
  G92 E0                                                                               ; reset Extruder
  ADAPTIVE_PURGE
